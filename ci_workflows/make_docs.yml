# make + upload documentation to https://lscsoft.docs.ligo.org/parallel_bilby/

docs:
  stage: docs
  tags:
    - cit
  image: containers.ligo.org/lscsoft/bilby/v2-bilby-python38
  script:
    - source activate python38
    - mkdir -p .pip38
    - pip --cache-dir=.pip38 install .
    # Make the documentation
    - apt-get update
    - apt-get -y install graphviz
    - cd docs
    - pip install -r requirements.txt
    - make clean
    - make html
  artifacts:
    paths:
      - docs/_build/html/

pages:
  stage: deploy
  tags:
    - cit
  dependencies:
    - docs
    - pytest
  script:
    - ls
    - mkdir public/
    - mv docs/_build/html/* public/
    - mv htmlcov/ public/
    - mv coverage_badge.svg public/
  artifacts:
    paths:
      - public
    expire_in: 30 days
  only:
    - master
